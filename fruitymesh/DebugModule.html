<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Module (moduleId 7) :: Fruitymesh</title>
  <link rel="canonical" href="http://mwaylabs.github.io/fruitymesh/fruitymesh/DebugModule.html">
  <meta name="generator" content="Antora 2.0.0">
  <link rel="stylesheet" href="../_/css/site.css">
  <link rel="stylesheet" href="../_/css/footer.css">
</head>

<body class="article">
  <header class="header" role="banner">
<header class="header" role="banner">
  <div class="navbar-top">
    <a class="navbar-logo" id="fruitymesh-logo-padding" href="https://mwaylabs.github.io/fruitymesh/fruitymesh/index.html">
      <div class="navbar-item">
        <img src="../_/img/fruitymesh_logo.png" alt="Fruitymesh">
      </div>
    </a>
    <div class="navbar-item">
      <div id="search-wrapper" class="border-color-fruitymesh>
        <input id="search-input" type="text" placeholder="Search...">
      </div>
    </div>
  </div>
  <nav class="navbar-bottom fruitymesh-header-color">
    <a href="https://github.com/mwaylabs/fruitymesh">
      <div class="navbar-item">Fruitymesh on Github</div>
    </a>
  </nav>
</header>

</header>
  <div class="main-wrapper">
<div class="navigation-container" data-component="" data-version="master">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <button class="navigation-toggle"></button>
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Quick-Start.html">Quick Start</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Usage.html">Usage</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Features.html">Features</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Developers.html">Developers</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Specification.html">Specification</a>
      </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="Modules.html">Modules</a>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="AdvertisingModule.html">Advertising Module</a>
      </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="DebugModule.html">Debug Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DfuModule.html">DFU Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="EnrollmentModule.html">Enrollment Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="IoModule.html">IO Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="MeshAccessModule.html">Mesh Access Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Node.html">Node</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ScanningModule.html">Scanning Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="StatusReporterModule.html">Status Report Module</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other Classes</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Logger.html">Logger</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="RecordStorage.html">Record Storage</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Class-Structure.html">Class Structure</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Debugging.html">Debugging</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Battery-Consumption.html">Battery Consumption</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="RecordStorage.html">Record Storage</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="The-FruityMesh-Algorithm.html">The Fruitymesh Algorithm</a>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="The-Algorithm-in-Detail.html">The Algorithm in Detail</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Simulator.html">Simulator</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="Tutorials.html">Tutorials</a>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Implementing-a-Custom-Module.html">Implementing a Custom Module</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="FAQ.html">FAQ</a>
      </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<article class="doc"><a name="section-top"></a>
<h1>Debug Module (moduleId 7)</h1>
<div class="sect1">
<h2 id="_purpose"><a class="anchor" href="#_purpose"></a>Purpose</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>Debug</em> module contains a collection of commands to debug network problems and test other functionality.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functionality"><a class="anchor" href="#_functionality"></a>Functionality</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>Debug</em> module does not perform a lot of functionality itself. It triggers actions from other moduels for debug purposes. It provides a flooding mode.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_terminal_commands"><a class="anchor" href="#_terminal_commands"></a>Terminal Commands</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_resetting_nodes"><a class="anchor" href="#_resetting_nodes"></a>Resetting Nodes</h3>
<div class="paragraph">
<p>Sometimes it is necessary to reset all nodes connected to a mesh at once. The reset command can be used for this purpose. After receiving the command, each node waits a predefined time before performing a reset. This time can be defined and is set to 10 seconds by default. This ensures that the packet is sent to all nodes before the reset process starts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Receiving nodes will reset within a few seconds
action [nodeId] debug reset {waitSeconds}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_request_discover_buffer"><a class="anchor" href="#_request_discover_buffer"></a>Request Discover Buffer</h3>
<div class="paragraph">
<p>To debug problems with discovery, it is useful to fetch the contents of the <a href="Specification.html" class="page">JOIN_ME</a> buffer from all nodes in a mesh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Receiving nodes will send back their buffer contents
action [nodeId] debug get_buffer</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ping"><a class="anchor" href="#_ping"></a>Ping</h3>
<div class="paragraph">
<p>To determine the latency, a ping can be sent to nodes. Nodes can only be pinged one at a time. Timing issues may occur if multiple nodes are pinged simultaneously. The optional ping mode can be set to unreliable (write_cmd) or reliable (write_req).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Sends a ping to a node and logs the time
action [nodeId] debug ping [count] [mode = r / u]

//Sends one ping message to nodeId 2 using write_cmd (unreliable)
action 2 debug ping 1 u</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pingpong"><a class="anchor" href="#_pingpong"></a>PingPong</h3>
<div class="paragraph">
<p>A ping packet can bounce multiple times between two nodes to get a better average of the latency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Bounces a ping back and forth multiple times
action [nodeId] debug pingpong [count] [mode]

//Bounces a packet back and forth 10 times between the current node and node 45
action 45 debug pingpong 10 u</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_leaf_ping"><a class="anchor" href="#_leaf_ping"></a>Leaf Ping</h3>
<div class="paragraph">
<p>The leaf ping will sends a ping command through the mesh starting from the current node. All leaf nodes will respond and the ping times will be logged on the terminal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Start the leaf ping
lping [count] [mode = r / u]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_flooding"><a class="anchor" href="#_flooding"></a>Flooding</h3>
<div class="paragraph">
<p>The DebugModule has a flooding mode where it generates messages every once in a while. This is helpful for generating a certain load on the network. Supported modes are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Off (0):</strong> No flooding and no listening</p>
</li>
<li>
<p><strong>Unreliable (2):</strong> Floods with WRITE_CMD packets</p>
</li>
<li>
<p><strong>Listen (3):</strong> Listens for floods from given node and counts them</p>
</li>
<li>
<p><strong>SplitData (4):</strong> Sends big messages that are split into multiple packets</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>//Activates a flooding mode to generate packets
action [nodeID] debug flood [destinationNodeId] [mode] [packetsPer100Sec]

//Tell node 1 to flood node 2 with 1 packet each second
action 1 debug flood 2 2 100

//Instruct node 2 to count packets from node 1
action 2 debug flood 1 3 0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_saving_retrieving_records"><a class="anchor" href="#_saving_retrieving_records"></a>Saving &amp; Retrieving Records</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to store, retrieve or delete a record by using the terminal on the local node. This will invoke the <a href="RecordStorage.html" class="page">RecordStorage</a> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Save record with given ID and data
saverec [recordId] [hexString | base64String]

//E.g. saves or updates a record with ID 1234 and data AA:BB:CC
saverec 1234 AA:BB:CC

//Get record with given ID
getrec [recordId]

//Delete record with given ID
delrec [recordId]</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_print_active_advertising_jobs"><a class="anchor" href="#_print_active_advertising_jobs"></a>Print Active Advertising Jobs</h3>
<div class="paragraph">
<p>Prints the registered advertising jobs of the advertising controller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">advjobs</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_heap"><a class="anchor" href="#_heap"></a>Heap</h3>
<div class="paragraph">
<p>Prints statistics about the current heap usage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">heap</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_flash_memory_map"><a class="anchor" href="#_flash_memory_map"></a>Flash Memory Map</h3>
<div class="paragraph">
<p>Prints a map of used flash memory blocks (1024 kb). 0 stands for empty and 1 for containing data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">memorymap</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_read_memory"><a class="anchor" href="#_read_memory"></a>Read Memory</h3>
<div class="paragraph">
<p>Sometimes it is useful to read back some of the memory contents of a node while being connected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">readblock [number | "uicr" | "ficr" | "ram"] [numBlocks]

//Read the first block of memory of the flash
readblock 0 1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_more"><a class="anchor" href="#_more"></a>More</h3>
<div class="paragraph">
<p>There are more commands that are not documented here. You can find them by looking at the <em>TerminalCommandHandler</em> in the source code. These commands may be removed or changed at any time.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Debug Module (moduleId 7)</h3>
  <div id="article-toc"></div>
</aside>
  </main>
</div>
  <footer class="footer fruitymesh-footer-padding">
<p>This project is under active development at the <a href="http://www.mwaysolutions.com/" >M-Way Solutions GmbH,</a> Germany.</p>
<p>We use FruityMesh ourselves in conjunction with our custom MeshGateway to build services such as connected lights, asset tracking and much more for our customers.</p>
</footer>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '..'
  window.antora.pagePath = '/fruitymesh/DebugModule.html'
</script>
<script src="../_/js/site.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js"></script>
<script src="../_/js/vendor/search.js"></script>
<script async src="../_/../search-index.js"></script>
<script src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/zoom.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script>
  tocbot.init({
    tocSelector: '#article-toc',
    contentSelector: 'article',
    headingSelector: 'h2, h3, h4, h5, h6',
    collapseDepth: 6,
    positionFixedSelector: '#article-toc',
    scrollSmooth: true,
  });
  var tocList = document.getElementById('article-toc').getElementsByClassName('toc-list');
  if (tocList && tocList.length > 0 && tocList[0].childNodes.length > 0) {
    document.getElementById('article-toc').parentNode.classList.remove('hidden');
  }
</script>
</body>

</html>
