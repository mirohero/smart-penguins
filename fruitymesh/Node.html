<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Node :: Fruitymesh</title>
  <link rel="canonical" href="http://mwaylabs.github.io/fruitymesh/fruitymesh/Node.html">
  <meta name="generator" content="Antora 2.0.0">
  <link rel="stylesheet" href="../_/css/site.css">
  <link rel="stylesheet" href="../_/css/footer.css">
<link rel="icon" type="image/png" href="../_/img/favicon.png" />
</head>

<body class="article">
  <header class="header" role="banner">
<header class="header" role="banner">
  <div class="navbar-top">
    <a class="navbar-logo" id="fruitymesh-logo-padding" href="https://mwaylabs.github.io/fruitymesh/fruitymesh/index.html">
      <div class="navbar-item">
        <img src="../_/img/fruitymesh_logo.png" alt="Fruitymesh">
      </div>
    </a>
    <div class="navbar-item">
      <div id="search-wrapper">
        <input id="search-input" type="text" placeholder="Search...">
      </div>
    </div>
  </div>
  <nav class="navbar-bottom fruitymesh-header-color">
    <a href="https://github.com/mwaylabs/fruitymesh">
      <div class="navbar-item">Fruitymesh on Github</div>
    </a>
  </nav>
</header>

</header>
  <div class="main-wrapper">
<div class="navigation-container" data-component="" data-version="master">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <button class="navigation-toggle"></button>
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Quick-Start.html">Quick Start</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Usage.html">Usage</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Features.html">Features</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Developers.html">Developers</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Specification.html">Specification</a>
      </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="Modules.html">Modules</a>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="AdvertisingModule.html">Advertising Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DebugModule.html">Debug Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DfuModule.html">DFU Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="EnrollmentModule.html">Enrollment Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="IoModule.html">IO Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="MeshAccessModule.html">Mesh Access Module</a>
      </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="Node.html">Node</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ScanningModule.html">Scanning Module</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="StatusReporterModule.html">Status Report Module</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other Classes</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Logger.html">Logger</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="RecordStorage.html">Record Storage</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Class-Structure.html">Class Structure</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Debugging.html">Debugging</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Battery-Consumption.html">Battery Consumption</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="RecordStorage.html">Record Storage</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="The-FruityMesh-Algorithm.html">The Fruitymesh Algorithm</a>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="The-Algorithm-in-Detail.html">The Algorithm in Detail</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Simulator.html">Simulator</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="Tutorials.html">Tutorials</a>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Implementing-a-Custom-Module.html">Implementing a Custom Module</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="FAQ.html">FAQ</a>
      </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<article class="doc"><a name="section-top"></a>
<h1>Node</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>ModuleId 0</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_purpose"><a class="anchor" href="#_purpose"></a>Purpose</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The node module is the central part of the FruityMesh algorithm. It is a
mandatory module. It is responsible for clustering and other mesh
related tasks and functionalities that are part of FruityMesh.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functionality"><a class="anchor" href="#_functionality"></a>Functionality</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The node keeps track of all <em>MeshConnections</em> and monitors connects and disconnects. It works in conjunction with the <em>MeshConnection</em> and <em>ConnectionManager</em> classes for this. The node is also responsible for broadcasting mesh discovery (<a href="Specification.html" class="page">JOIN_ME</a>) packets. It also activates scanning if necessary and monitors the incoming discovery packets of other nodes. It creates new <em>MeshConnections</em> to other nodes if necessary. A state machine is used to toggle between different discovery states.</p>
</div>
<div class="paragraph">
<p>The node only permits one mesh handshake at a certain time. During the handshake, both mesh nodes exchange information about their clusters and decide which cluster is the biggest one. The packets used are specified under <a href="#_clustering_messages">Clustering Messages</a>. During the handshake, a backup of the current cluster state is made and used throughout the handshake. After the handshake, cluster changes that happened in the meantime are sent to these connections. Updates of the cluster size or structure are also sent to all <a href="MeshAccessModule.html" class="page">MeshAccessConnections</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There are a number of undocumented commands. These are mostly for debugging and there is no guarantee that they will be available in future builds.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reboot_message"><a class="anchor" href="#_reboot_message"></a>Reboot Message</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On reboot, the firmware sends a JSON to the connected device, providing more information about the reboot. The JSON has the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">{
	"type":"reboot",
	"reason":3, //Integer, see below
	"code1":17, //Additional information, depending on the reason given. The valid codes are purposefully undocumented, as they are highly subject to change and are mainly intended to help firmware developers.
	"stack":128, //Stack address of the reboot, if available
	"version":80021 //Version of the firmware
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason can have the following values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNKNOWN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reboot reason is unknown. A typical case where this can happen is when the node lost power and thus was unable to save any valid reason. Note that the reason really is <strong>unknown</strong> and as such could be any other reason as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HARDFAULT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A hard fault occurred on the device.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">APP_FAULT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some runtime check of the firmware failed and the device rebooted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD_FAULT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Softdevice crashed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIN_RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The power reset button was pressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WATCHDOG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The watchdogs were not fed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FROM_OFF_STATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node previously was turned off and is now turned on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCAL_RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>reset</code> command without any additional parameters was used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>action <em>NodeId</em> node reset</code> command was sent to the node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENROLLMENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reboot happened because of an enrollment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PREFERRED_CONNECTIONS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The preferred connections were set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200-255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USER_DEFINED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some user defined reboot reasons.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_terminal_commands"><a class="anchor" href="#_terminal_commands"></a>Terminal Commands</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_setting_the_discovery_state"><a class="anchor" href="#_setting_the_discovery_state"></a>Setting The Discovery State</h3>
<div class="paragraph">
<p><code>action [nodeId] node discovery [on / off]</code></p>
</div>
<div class="paragraph">
<p>It might be necessary to switch the node&#8217;s state machine into a
different discovery state. This can be done through the mesh and can be
used by a MeshGateway to turn off discovery once all enrolled nodes are
connected. This allows the node to use a very low power consumption if
scanning doesn&#8217;t need to be active for other tasks.</p>
</div>
<div class="paragraph">
<p>Once the node loses a connection to one of its partners, it will
automatically switch discovery on again.</p>
</div>
<div class="paragraph">
<p>Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//E.g. switch discovery off for all nodes
action 0 node discovery off</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response acknowledges the receipt of the command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">{"type":"set_discovery_result","nodeId":123,"module":0}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_preferred_connections"><a class="anchor" href="#_setting_preferred_connections"></a>Setting Preferred Connections</h3>
<div class="paragraph">
<p><code>action [nodeId] node set_preferred_connections [ignored / penalty] {up to eight preferred nodeIDs}</code></p>
</div>
<div class="paragraph">
<p>Sets the given node IDs as preferred connection partners while meshing. Other partners will be either completely ignored or their cluster score gets a heavy penalty. Executing this command without any nodeID disables this feature. After saving the preferred connections, the node reboots after a delay of 10 seconds. The "ignored / penalty" parameter determines the behaviour regarding the unpreferred connection partners, meaning any node ID that is NOT in the associated list.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For a connection to happen, both connection partners have to set each other as a preferred connection partner. This means to set the preferred connections of a mesh, it is best to start at the leaves of the mesh.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using this command with the "ignored" parameter must be used with caution as using invalid or unreachable nodeIDs results in a state where the mesh can not be created. If this happened, there are two options:<br>
1. Flash the beacon. This erases the set preferred connections.<br>
2. Connect to the beacon via a mesh access connection and execute the command again with the correct parameters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//E.g. Sets the preferred connections of 123 to 17, 32 and 12. Other connections partners are ignored for meshing.
action 123 node set_preferred_connections ignored 17 32 12</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response acknowledges the receipt of the command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">{"type":"set_preferred_connections_result","nodeId":123,"module":0}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ping_a_node"><a class="anchor" href="#_ping_a_node"></a>Ping a node</h3>
<div class="paragraph">
<p><code>action [nodeId] node ping {requestHandle}</code></p>
</div>
<div class="paragraph">
<p>Pings the given nodeId. Once received, a ping response is sent back.</p>
</div>
<div class="paragraph">
<p>Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">action 123 node ping
action 123 node ping 100</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response acknowledges the receipt of these commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">{"type":"ping","nodeId":123,"module":0,"requestHandle":0}"
{"type":"ping","nodeId":123,"module":0,"requestHandle":100}"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_querying_device_capabilities"><a class="anchor" href="#_querying_device_capabilities"></a>Querying Device Capabilities</h3>
<div class="paragraph">
<p><code>request_capability [nodeId\{0}]</code></p>
</div>
<div class="paragraph">
<p>Requests the capabilities of the node with <em>nodeId</em>. The receiver then answers with several messages, each representing a single capability. After all capabilities are sent, the receiver sends a last message indicating the end of the transaction.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A single capability message is a rather big message with 128 bytes in size. As such only a single node in the mesh should be queried for it&#8217;s capabilities at a time, else the mesh would be put under heavy load. Broadcasting this command is not supported by the firmware for this reason.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Requesting capabilities of node 4
request_capability 4</code></pre>
</div>
</div>
<div class="paragraph">
<p>The receiver sends all its capabilities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">{
	"nodeId":4,
	"type":"capability_entry",
	"index":0, // Ascending unique number for each capability
	"capabilityType":2, // 1: Hardware, 2: Software
	"manufacturer":"M-Way Solutions GmbH", // Up to 31 chars
	"model":"BlueRange Node", // Up to 52 chars
	"revision":"0.8.451" // Up to 31 chars
}
{
	"nodeId":4,
	"type":"capability_entry",
	"index":1,
	"capabilityType":1,
	"manufacturer":"Vendor GmbH",
	"model":"Super Fast Chip",
	"revision":"Full ASCII support &lt;(^.^)&gt; 4.1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And ends the transaction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">{
	"nodeId":4,
	"type":"capability_end",
	"amount":2 // The amount of capabilities just sent. Can be used to check if all capabilities were received.
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sensor_values"><a class="anchor" href="#_sensor_values"></a>Sensor Values</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">// Generate a sensor event and send through mesh
// (Only used for debugging)
component_sense [nodeId] [moduleId] [actionType] [component] [registerAddress] [dataHex] {requestHandle=0}

//E.g. broadcast sensor event for module 123 from component 7 and registerAddress 77
component_sense 0 123 0 7 77 AA:BB</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following low-level data structure transports sensor measurement values across the mesh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">enum SensorMessageActionType {
    UNSPECIFIED = 0, // E.g. Generated by sensor itself
    ERROR_RSP = 1, // Error during READ/WRITE/...
    READ_RSP = 2, // Response following a READ
    WRITE_RSP = 3 // Response following a WRITE_ACK
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketHeader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">moduleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module that generated this value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional request handle, otherwise 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actionType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the above actionTypes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some number identifying the source of the measurements such as a lamp head (<strong>vendor specific</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">registerAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An address used to differentiate data transported such as a hardware register number or a message profile id (<strong>vendor specific</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actual binary data that represents a sensor reading or multiple.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The packet header consumes 12 bytes, which allows for 8 bytes of payload in a single packet and should be enough for most sensor values. For bigger payloads, it will be split.</p>
</div>
<div class="paragraph">
<p>The output on a sink is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId": 5,                // sender
	"type": "component_sense",  // discriminator
	"module": 123,              // moduleId
	"requestHandle": 0,
	"actionType" : 0,
	"component" : 7,
	"register" : 77,
	"payload": "abcdeQ=="       // base64 encoded
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_actor_message"><a class="anchor" href="#_actor_message"></a>Actor Message</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">// Instruct device to write data into a register address
component_act [nodeId] [moduleId] [actionType] [component] [registerAddress] [dataHex] {requestHandle=0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following message is used for transporting write or read requests through the mesh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">enum ActorMessageActionType {
    RESERVED = 0, // Unused
    WRITE = 1, // Write without acknowledgement
    READ = 2, // Read a value
    WRITE_ACK = 3 // Write with acknowledgement
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketHeader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">moduleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module that should act on the message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional request handle, otherwise 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actionType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the above actionTypes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some number identifying the destination for the action (<strong>vendor specific</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">registerAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An address, e.g. hardware register number or a message profile id where the data should be written (<strong>vendor specific</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For READ, this must be a singly byte that represents the number of bytes to read. For WRITE and WRITE_ACK, the payload is the bytes that should be written.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>No JSON representation is necessary for the moment as the meshgateway will not react on <em>act</em> messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getting_basic_information_local_command"><a class="anchor" href="#_getting_basic_information_local_command"></a>Getting Basic Information (Local Command)</h3>
<div class="paragraph">
<p><code>status</code></p>
</div>
<div class="paragraph">
<p>It is very conveniant to get easily readable information about a node.
The status command displays the currently active connections and their
state. It also display device information and the clustering state.</p>
</div>
<div class="paragraph">
<p>The following will be printed on the local terminal after the command
was entered:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Node BBBBB (nodeId: 1) vers: 80000, NodeKey: 01:00:....:00:00

Mesh clusterSize:10, clusterId:4201185286
Enrolled 1: networkId:10, deviceType:0, NetKey 04:00:....:00:00, UserBaseKey 00:00:....:00:00
Addr:00:00:00:01:00:00, ConnLossCounter:3, AckField:0, State: 1

CONNECTIONS 2 (freeIn:0, freeOut:2, pendingPackets:0
IN (0) FM 7, state:4, cluster:fa690006(8), sink:-1, Queue:0-0(0), Buf:1/7, mb:0, hnd:16
OUT(1) FM 10, state:4, cluster:fa690006(1), sink:-1, Queue:0-0(0), Buf:1/7, mb:1, hnd:17</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_terminal_mode_local_command"><a class="anchor" href="#_setting_terminal_mode_local_command"></a>Setting Terminal Mode (Local Command)</h3>
<div class="paragraph">
<p>When working with UART (Terminal and UART must be enabled), FruityMesh
supports a convenient blocking terminal mode with echo back
functionality. For communication with another device such as a
MeshGateway, an interrupt based input method and JSON output is used. To
toggle between these two modes, there are two commands:</p>
</div>
<div class="paragraph">
<p><code>startterm</code></p>
</div>
<div class="paragraph">
<p>Using <em>startterm</em> invokes a blocking mode where all functionality is
halted and user input is received in a busy loop until a line feed '\r'
is received. The command is then processed and other functionality
is resumed. The input is echoed back on the terminal.
Backspace is supported as well for most terminal programs. If the
command isn&#8217;t recognized, a warning is echoed.</p>
</div>
<div class="paragraph">
<p><code>stopterm</code></p>
</div>
<div class="paragraph">
<p>The <em>stopterm</em> command switches the node into an interrupt based input
mode where terminal input does not affect the functionality until a line
feed '\r' is received. All output messages are in JSON format.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rebooting_local_command"><a class="anchor" href="#_rebooting_local_command"></a>Rebooting (Local Command)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>reset</code></p>
</div>
<div class="paragraph">
<p>To reset the node via the terminal, enter this command
and a software reboot is performed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_time_synchronization"><a class="anchor" href="#_time_synchronization"></a>Time Synchronization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To synchronize a time over the mesh, the
time needs first to be set on the local node using the <em>settime</em> command.
The time is stored internally as an unsigned 32-bit integer.</p>
</div>
<div class="paragraph">
<p><code>settime [u32 unixTimestampSec] [i16 offsetMinutes]</code></p>
</div>
<div class="paragraph">
<p>Afterwards, the time of the local node can be queried using:</p>
</div>
<div class="paragraph">
<p><code>gettime</code></p>
</div>
<div class="paragraph">
<p>The output gives the current time and date of the node in a
human-readable format. This is only an approximate
calculation. It is just to verify if the time was set correctly.
Internally, the nodes work with Unix time stamps.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_querying_active_modules"><a class="anchor" href="#_querying_active_modules"></a>Querying Active Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>get_modules [nodeId]</code></p>
</div>
<div class="paragraph">
<p>Often it is necessary to get a list of modules that are available on a
node. The list provided by the <em>get_modules</em> command includes
all modules that are available
(compiled into the firmware): their <em>moduleId</em>, their version and whether
they are currently active.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">{
    "nodeId": 1,
    "type": "module_list",
    "modules": [
        {
            "id": 1,
            "version": 2,
            "active": 1
        },
        {
            "id": 2,
            "version": 1,
            "active": 0
        },
        // ...
    ]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_raw_data"><a class="anchor" href="#_sending_raw_data"></a>Sending Raw Data</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general_overview"><a class="anchor" href="#_general_overview"></a>General Overview</h3>
<div class="imageblock">
<div class="content">
<img src="_images/raw_data_flow.png" alt="raw data flow">
</div>
</div>
<div class="paragraph">
<p>Sending raw data can be used to send any arbitrary data, e.g. zip files. The data to be sent is split into chunks that are then sent through the mesh. The data to be sent is called the "payload".</p>
</div>
<div class="paragraph">
<p>Every raw data transaction (except <em>raw_data_light</em>, which will be explained later) starts with a <em>raw_data_start</em> message. This message includes the amount of chunks in the transaction and the protocol of the payload. Once the receiver receives this message, it answers with a <em>raw_data_start_received</em> message, which indicates to the sender that the receiver is ready to receive the chunks.</p>
</div>
<div class="paragraph">
<p>When the sender receives the <em>raw_data_start_received</em> message, it starts sending all <em>raw_data_chunk</em> objects. In addition of payload data, every <em>raw_data_chunk</em> includes a chunk ID, which is a unique (regarding the current transaction) ascending number, starting at 1 for the first <em>raw_data_chunk</em> object. chunk ID 0 is reserved for the <em>raw_data_start</em>. Using this chunk ID, and the information of the amount of chunks form the <em>raw_data_start</em> message, the receiver is able to determine the last chunk in the transaction. Once it receives the last chunk, it reports back to the sender using a single <em>raw_data_report</em>. This message includes the chunk IDs of up to three missing chunks. If all chunks were received, the list of missing chunks is empty, which tells the sender that the transaction was successful. If however, the list of missing chunks is not empty, the sender must send the chunks with the corresponding chunk IDs again. The last chunk IDs of the previous <em>raw_data_report</em> message acts as a last chunk, regarding the sending of additional <em>raw_data_report</em>. This sending of <em>raw_data_chunk</em> and <em>raw_data_report</em> is repeated until <em>raw_data_report</em> has an empty list of missing chunk IDs.</p>
</div>
<div class="paragraph">
<p>All devices involved in the communication (sender, receiver, and the mesh) are able to cancel the communication by sending a <em>raw_data_error</em> message to the sender as well as the receiver. If the sender or the receiver is the device that hung up the transmission, it is allowed to not send the error to itself. The <em>raw_data_error</em> message includes an error code, indicating the reason for the cancellation. It is possible to receive a <em>raw_data_error</em> message without an open transmission. This can happen if the sender cancels the transmission using a <em>raw_data_error</em>, but this error is dropped during the transmission. The receiver then might send another <em>raw_data_error</em> indicating a timeout while the sender already canceled the communication. Such messages without an open transmission may be discarded.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dropped_messages"><a class="anchor" href="#_dropped_messages"></a>Dropped Messages</h3>
<div class="paragraph">
<p>As any other message in the mesh, every message in the raw send protocol could be dropped. This section describes how an implementation must behave in such scenarios. It also describes the obligations of the sender and the receiver.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dropped message</th>
<th class="tableblock halign-left valign-top">Reaction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw_data_start<br>
raw_data_start_received</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sender must send the <em>raw_data_start</em> again after a timeout of 10 seconds or stop the transmission. The receiver has to be able to handle several successive <em>raw_data_start</em> messages with the same content (in case the <em>raw_data_start_received</em> message is dropped) and close a dropped connection after a timeout of 15 seconds (in case the sender does not send another <em>raw_data_start</em>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw_data_chunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Missing chunks are reported in <em>raw_data_report</em> once the last chunk is received. These missing chunks must be resent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last raw_data_chunk or raw_data_report</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using the ChunkID, both sender and receiver are able to identify the last data chunk. If this message or the <em>raw_data_report</em> are dropped, the sender must send the last chunk again. This means that the receiver is only allowed to save the last chunk ID once the first chunk after a <em>raw_data_report</em> is received, not immediately after the <em>raw_data_report</em> is sent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw_data_error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a <em>raw_data_error</em> message is dropped, the sender or receiver has already canceled the transmission, leading to the sending of another <em>raw_data_error</em> upon receiving an invalid out-of-transmission message or a <em>raw_data_error</em> indicating a timeout. In the rare cases where the origin of the <em>raw_data_error</em> is the mesh itself, it could happen that both <em>raw_data_error</em> messages are dropped. In such cases the connection is still up, but will probably create another <em>raw_data_error</em> once the ill-formed chunk is sent again.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_transmission_start"><a class="anchor" href="#_transmission_start"></a>Transmission Start</h3>
<div class="paragraph">
<p><code>raw_data_start [receiverId] [destinationModuleId] [numChunks] [protocolId] {requestHandle = 0}</code></p>
</div>
<div class="paragraph">
<p>This command starts a raw data transmission. The payload shall be sent using <em>raw_data_chunk</em> messages.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">receiverId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node ID that this message should be sent to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destinationModuleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module ID is used for giving context to this message. If the transmission should only be printed on the receiver and otherwise be ignored by the firmware, it must be set to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numChunks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of Chunks for the total message. Must not be 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocolId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the protocol IDs mentioned in the table below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A handle that can be used to distinguish between different raw data transmissions (Default: 0)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Protocol ID</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invalid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invalid protocol ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A raw HTTP request or response</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GZIPPED_JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A JSON that was gzipped</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 - 199</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not yet used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 - 255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User defined</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May be different in each implementation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON-capable device, the <em>raw_data_start</em> is printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId":5,
	"type":"raw_data_start",
	"module":4,
	"numChunks":3,
	"protocol":1,
	"fmKeyId":2,
	"requestHandle":0
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_accept_transmission"><a class="anchor" href="#_accept_transmission"></a>Accept Transmission</h3>
<div class="paragraph">
<p><code>raw_data_start_received [receiverId] [destinationModuleId] {requestHandle = 0}</code></p>
</div>
<div class="paragraph">
<p>Once a <em>raw_data_start</em> is received, the receiver shall send the sender a <em>raw_data_start_received</em> message.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">receiverId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node ID that this message should be sent to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destinationModuleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module ID is used for giving context to this message. If the transmission should only be printed on the receiver and otherwise be ignored by the firmware, it must be set to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A handle that can be used to distinguish between different raw data transmissions (Default: 0)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON-capable device, the <em>raw_data_start</em> is printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId":5,
	"type":"raw_data_start_received",
	"module":4,
	"requestHandle":0
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_subsequent_chunk_messages"><a class="anchor" href="#_subsequent_chunk_messages"></a>Subsequent Chunk Messages</h3>
<div class="paragraph">
<p><code>raw_data_chunk [receiverId] [destinationModuleId] [chunkId] [payloadHex] {requestHandle = 0}</code></p>
</div>
<div class="paragraph">
<p>Once a raw transmission has been started, the appropriate number of chunks should follow in the correct order. Once the last chunk is received by the receiver, it is possible to reassemble and parse the whole message. The <em>moduleId</em> is present in all chunks so that they can be assigned to the correct stream and to avoid clashes between different modules. A module can send intermittent data streams if is uses different request handles.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">receiverId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The NodeID that this message should be sent to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destinationModuleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ModuleId is used for giving context to this message. If the transmission should only be printed on the receiver and otherwise be ignored by the firmware, it must be set to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunkId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of this data chunk starting from 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">payloadHex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HexString or Base64String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The binary data to send. E.g. AA:BB:CC. The maximum length is 60 bytes for HexStrings, 120 bytes for Base64Strings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A handle that can be used to distinguish between different raw data transmissions (Default: 0)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON-capable device, the <em>raw_data_start</em> is printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId":5,
	"type":"raw_data_chunk",
	"module":4,
	"chunkId":1,
	"payload":"abcdeQ==",
	"requestHandle":0
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_send_report"><a class="anchor" href="#_send_report"></a>Send Report</h3>
<div class="paragraph">
<p><code>raw_data_report [receiverId] [destinationModuleId] [MissingChunkIds] {requestHandle = 0}</code></p>
</div>
<div class="paragraph">
<p>Once the last chunk is received, the receiver sends this message to the sender, indicating either a successful transmission (empty missing chunk IDs) or informs the sender about missing chunk IDs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">receiverId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node ID that this message should be sent to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destinationModuleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module ID is used for giving context to this message. If the transmission should only be printed on the receiver and otherwise be ignored by the firmware, it must be set to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MissingChunkIds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated integers or the literal string "-" (without "")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Up to three chunk IDs of missing chunks. Must not contain spaces! E.g. 2,17,312</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A handle that can be used to distinguish between different raw data transmissions (Default: 0)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON-capable device, the <em>raw_data_start</em> is printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId":5,
	"type":"raw_data_report",
	"module":4,
	"missing":[2,17,312],
	"requestHandle":0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in cases where the transmission was successful:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId":5,
	"type":"raw_data_report",
	"module":4,
	"missing":[],
	"requestHandle":0
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_send_error"><a class="anchor" href="#_send_error"></a>Send Error</h3>
<div class="paragraph">
<p><code>raw_data_error [receiverId] [destinationModuleId] [errorCode] [destination] {requestHandle = 0}</code></p>
</div>
<div class="paragraph">
<p>This command indicates that some error occurred and the transmission must be closed. Will is sent to the receiver as well as the sender.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unexpected end of transmission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Three timeouts happened without receiving a message from the transmission partner.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not in a transmission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>raw_data_chunk</em> or <em>raw_data_report</em> was received without an open transmission.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Malformed Message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A message was received which was malformed and did not fit any other error code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsupported Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The receiver is unable to interpret the given protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Malformed GZIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The receiver got all chunks but could could not unpack the GZIP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Malformed Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown in case of a GZIP communication. The unpacking worked, but the provided type inside the GZIP JSIN was unknown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invalid Chunk ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The given chunk ID was out of range.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0, 4 - 199</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not yet used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 - 255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User defined</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May be different in each implementation.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination Code</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The error is sent to the sender.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receiver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The error is sent to the receiver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The error is sent both to the sender and the receiver.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON-capable device, the <em>raw_data_error</em> is printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId":5,
	"type":"raw_data_error",
	"module":4,
	"error":1,
	"destination":1
	"requestHandle":0
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_send_single_light_message_of_arbitrary_data"><a class="anchor" href="#_send_single_light_message_of_arbitrary_data"></a>Send Single Light Message Of Arbitrary Data</h3>
<div class="paragraph">
<p><code>raw_data_light [receiverId] [destinationModuleId] [protocolId] [payload] {requestHandle = 0}</code></p>
</div>
<div class="paragraph">
<p>Sends a single, responseless chunk of arbitrary data to the receiver. There is no guarantee that the message is transmitted. The sender should provide some resending logic.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">receiverId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node ID that this message should be sent to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destinationModuleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module ID is used for giving context to this message. If the transmission should only be printed on the receiver and otherwise be ignored by the firmware, it must be set to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocolId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the protocol IDs mentioned in the table of raw_data_start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">payloadHex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HexString or Base64String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The binary data to send. E.g. AA:BB:CC. The maximum length is 60 bytes for HexStrings, 120 bytes for Base64Strings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A handle that can be used to distinguish between different raw data transmissions (Default: 0)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON-capable device, the <em>raw_data_start</em> is printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId":5,
	"type":"raw_data_light",
	"module":4,
	"protocol":2,
	"payload":"abcdeQ==",
	"requestHandle":0
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_messages"><a class="anchor" href="#_messages"></a>Messages</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_clustering_messages"><a class="anchor" href="#_clustering_messages"></a>Clustering Messages</h3>
<div class="sect3">
<h4 id="_clusterwelcome_local_handshake_between_two_nodes"><a class="anchor" href="#_clusterwelcome_local_handshake_between_two_nodes"></a>ClusterWelcome (Local Handshake Between Two Nodes)</h4>
<div class="paragraph">
<p>The <em>ClusterWelcome</em> Packet is sent be the node that thinks it has the bigger cluster. If not, the other node will also send a <em>ClusterWelcome</em> packet so both nodes know who is bigger.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketHeader</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>messageType</em>: MESSAGE_TYPE_CLUSTER_WELCOME(20)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">meshWriteHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write handle for RX characteristics of the mesh for data transmission. (Allows to skip service discovery)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hopsToSink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of hops to sink if there is one, otherwise -1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">preferredConnectionInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preferred interval for the <em>meshConnection</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NetworkId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network ID of the other clusters</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_clusterack1_local_handshake_between_two_nodes"><a class="anchor" href="#_clusterack1_local_handshake_between_two_nodes"></a>ClusterAck1 (Local Handshake Between Two Nodes)</h4>
<div class="paragraph">
<p>Acknowledge packet sent by the smaller cluster to acknowledge that it is now participating in the mesh.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketHeader</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>messageType</em>: <code>MESSAGE_TYPE_CLUSTER_ACK_1</code> (21)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hopsToSink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hops to the shortest sink</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">preferredConnectionInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preferred interval for the <em>meshConnection</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_clusterack2_local_handshake_between_two_nodes"><a class="anchor" href="#_clusterack2_local_handshake_between_two_nodes"></a>ClusterAck2 (Local Handshake Between Two Nodes)</h4>
<div class="paragraph">
<p>Acknowledge packet sent by the bigger cluster after receiving ack1 from the smaller cluster</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketHeader</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">messageType: <code>MESSAGE_TYPE_CLUSTER_ACK_2</code> (22)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hopsToSink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of hops to sink if there is one, otherwise -1.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_clusterinfoupdate"><a class="anchor" href="#_clusterinfoupdate"></a>ClusterInfoUpdate</h4>
<div class="paragraph">
<p>This packet informs a node about a change in the cluster size or structure. It can be sent throughout the mesh but is modified on each node before resending. It will only give the change in clusterSize and not the absolute value, the node must keep count itself. It will however give the absolute size if it is sent over a MeshAccessConnection.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketHeader</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>messageType</em>: <code>MESSAGE_TYPE_CLUSTER_INFO_UPDATE</code> (23)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>deprecated</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change in <em>clusterSize</em> or absolute size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hopsToSink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of hops to sink if there is one, otherwise -1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8 : 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionMasterBitHandover</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hands over the <em>masterBit</em> to the bigger cluster. If sent over the <em>MeshAccessConnection</em>, this is 1 if the node has the <em>masterBit</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8 : 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next expected sequence number for <em>clusterUpdate</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6 bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8 : 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ping"><a class="anchor" href="#_ping"></a>ping</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketModule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn Packet Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ModuleId = 0, Message Type = 51, Action Type = 3.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ping_response"><a class="anchor" href="#_ping_response"></a>ping response</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketModule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn Packet Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ModuleId = 0, Message Type = 52, Action Type = 3.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_raw_data_messages"><a class="anchor" href="#_raw_data_messages"></a>Raw Data Messages</h3>
<div class="sect3">
<h4 id="_raw_data_start"><a class="anchor" href="#_raw_data_start"></a><em>raw_data_start</em></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketModule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn Packet Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Type = 54, Action Type = 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of Chunks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total amount of raw_data_chunk messages for this transmission.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See above for a list of valid protocol IDs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmKeyId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">See EncryptionKeys Heading.</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_raw_data_start_received"><a class="anchor" href="#_raw_data_start_received"></a><em>raw_data_start_received</em></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketModule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn Packet Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Type = 54, Action Type = 1.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_raw_data_error"><a class="anchor" href="#_raw_data_error"></a><em>raw_data_error</em></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketModule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn Packet Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Type = 54, Action Type = 4.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See above for a list of possible error codes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See above for a list of possible Destination Codes.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_raw_data_chunk"><a class="anchor" href="#_raw_data_chunk"></a><em>raw_data_chunk</em></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketModule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn Packet Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Type = 54, Action Type = 2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chunk ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of this chunk. The first chunk has ID 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reserved value that must be set to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[1-60]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The payload.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_raw_data_report"><a class="anchor" href="#_raw_data_report"></a><em>raw_data_report</em></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketModule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn Packet Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Type = 54, Action Type = 3.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32[3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">missings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IDs of the missing chunks.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_raw_data_chunk_2"><a class="anchor" href="#_raw_data_chunk_2"></a><em>raw_data_chunk</em></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="Specification.html" class="page">connPacketHeader</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn Packet Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Type = 55</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">module ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module ID which should receive this message. Must be 0 in most cases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request Handle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The request Handle under which the receiver may (or may not) answer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See above for a list of all protocol IDs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[1-60]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The payload.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Node</h3>
  <div id="article-toc"></div>
</aside>
  </main>
</div>
  <footer class="footer fruitymesh-footer-padding">
<p>This project is under active development at the <a href="http://www.mwaysolutions.com/" >M-Way Solutions GmbH,</a> Germany.</p>
<p>We use FruityMesh ourselves in conjunction with our custom MeshGateway to build services such as connected lights, asset tracking and much more for our customers.</p>
</footer>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '..'
  window.antora.pagePath = '/fruitymesh/Node.html'
</script>
<script src="../_/js/site.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js"></script>
<script src="../_/js/vendor/search.js"></script>
<script async src="../_/../search-index.js"></script>
<script src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/zoom.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script>
  tocbot.init({
    tocSelector: '#article-toc',
    contentSelector: 'article',
    headingSelector: 'h2, h3, h4, h5, h6',
    collapseDepth: 6,
    positionFixedSelector: '#article-toc',
    scrollSmooth: true,
  });
  var tocList = document.getElementById('article-toc').getElementsByClassName('toc-list');
  if (tocList && tocList.length > 0 && tocList[0].childNodes.length > 0) {
    document.getElementById('article-toc').parentNode.classList.remove('hidden');
  }
</script>
</body>

</html>
